<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relevant News | Ahmed RaGaB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --navy-blue: #1e3799; 
            --forest-green: #0a3d21; 
            --slate-grey: #4a69bd;
            --light-grey: #f1f2f6; 
        }
        body { background-color: var(--light-grey); font-family: 'Inter', sans-serif; padding-top: 100px; text-align: center; color: #2f3640; }
        
        .nav-link { color: #94a3b8 !important; font-weight: 500; transition: 0.2s; }
        .nav-link.active { color: var(--navy-blue) !important; font-weight: 800 !important; }

        .choice-card { background: white; padding: 40px; border-radius: 20px; border: 1px solid #ddd; transition: 0.3s; cursor: pointer; height: 100%; display: flex; flex-direction: column; align-items: center; }
        .choice-card:hover { border-color: var(--navy-blue); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .icon-big { font-size: 3rem; color: var(--navy-blue); margin-bottom: 20px; }
        
        #action-zone { display: none; margin-top: 30px; }
        .timer-display { font-size: 2rem; font-weight: bold; color: var(--navy-blue); margin-bottom: 10px; }
        .score-display { font-size: 1.2rem; color: var(--forest-green); font-weight: 600; margin-bottom: 20px; }

        /* News Grid */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; text-align: left; }
        .news-tile { background: white; border-radius: 12px; padding: 20px; border-top: 5px solid var(--navy-blue); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .news-tile h5 { font-weight: 800; color: var(--navy-blue); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;}
        .headline-link { display: block; font-size: 0.95rem; color: #2f3640; text-decoration: none; padding: 8px 0; transition: 0.2s; font-weight: 600; }
        .headline-link:hover { color: var(--slate-grey); }
        .reason-text { font-size: 0.8rem; color: #64748b; font-style: italic; margin-top: 8px; display: block; border-left: 2px solid #ddd; padding-left: 10px; }

        /* Game Controls */
        .d-pad { display: grid; grid-template-columns: repeat(3, 50px); gap: 10px; justify-content: center; margin-top: 20px; }
        .d-btn { width: 50px; height: 50px; background: #fff; border: 1px solid #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }
        .up { grid-column: 2; } .left { grid-column: 1; grid-row: 2; } .down { grid-column: 2; grid-row: 2; } .right { grid-column: 3; grid-row: 2; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html" style="color: var(--navy-blue);">RaGaB.de</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link px-3" href="index.html">Home</a>
                <a class="nav-link active px-3" href="value.html">Relevant News</a>
            </div>
        </div>
    </nav>

    <div class="container" id="selection-screen">
        <h2 class="mb-5 mt-4" style="font-weight: 800;">Executive Intelligence Access</h2>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="choice-card" id="btn-game">
                    <div class="icon-big"><i class="fa-solid fa-gamepad"></i></div>
                    <h4>Focus Challenge</h4>
                    <p class="text-muted small">Win a 20s round of Snake to unlock.</p>
                    <div class="d-flex gap-2 mt-auto w-100">
                        <button class="btn btn-outline-secondary w-50 speed-btn" data-speed="150">Slow</button>
                        <button class="btn btn-primary w-50 speed-btn" data-speed="80">Fast</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="choice-card" onclick="startPath('quote')">
                    <div class="icon-big"><i class="fa-solid fa-quote-left"></i></div>
                    <h4>Mindset Protocol</h4>
                    <p class="text-muted small">Unlock via 15s of philosophical reflection.</p>
                    <button class="btn btn-navy text-white mt-auto w-100" style="background: var(--navy-blue);">Begin 15s Reflection</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="action-zone">
        <div class="timer-display" id="timer">00:00</div>
        <div class="score-display" id="score-box" style="display:none;">Score: <span id="current-score">0</span></div>
        <div id="content-area" class="p-4 bg-white border rounded shadow-sm" style="min-height: 400px; display:flex; flex-direction:column; justify-content:center;">
        </div>
    </div>

    <script>
        let timerInterval, gameInterval, snakeScore = 0;

        document.querySelectorAll('.speed-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                startPath('game', parseInt(btn.dataset.speed));
            });
        });

        async function startPath(type, speed = 100) {
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('action-zone').style.display = 'block';
            
            let timeLeft = (type === 'quote') ? 15 : 20;
            updateTimerDisplay(timeLeft);

            if (type === 'quote') {
                const res = await fetch('quotes.json');
                const data = await res.json();
                const q = data.quotes[Math.floor(Math.random() * data.quotes.length)];
                document.getElementById('content-area').innerHTML = `<h3 class="fw-light italic px-md-5">"${q}"</h3>`;
            } else {
                document.getElementById('score-box').style.display = 'block';
                document.getElementById('content-area').innerHTML = `
                    <canvas id="snakeCanvas" width="300" height="300" style="background:#111; display:block; margin:auto; border-radius:10px;"></canvas>
                    <div class="d-pad">
                        <div class="d-btn up" id="up"><i class="fa-solid fa-caret-up"></i></div>
                        <div class="d-btn left" id="left"><i class="fa-solid fa-caret-left"></i></div>
                        <div class="d-btn down" id="down"><i class="fa-solid fa-caret-down"></i></div>
                        <div class="d-btn right" id="right"><i class="fa-solid fa-caret-right"></i></div>
                    </div>`;
                startSnakeGame(speed);
            }

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    clearInterval(gameInterval);
                    revealNews();
                }
            }, 1000);
        }

        function updateTimerDisplay(s) {
            document.getElementById('timer').innerText = `ACCESS IN: 00:${s.toString().padStart(2, '0')}`;
        }

        async function revealNews() {
            const area = document.getElementById('content-area');
            document.getElementById('score-box').style.display = 'none';
            document.getElementById('timer').innerHTML = "PROTOCOL COMPLETE";
            area.innerHTML = `<div class="p-5 text-center"><div class="spinner-border text-primary"></div><p class="mt-3">Syncing News Signal...</p></div>`;

            try {
                const res = await fetch('./top_news.json?v=' + new Date().getTime());
                const aiNewsArray = await res.json();
                let html = `<div class="news-grid">`;
                const iconMap = { "Automated Driving Tech": "fa-car-side", "AI & Robotics": "fa-robot", "Finance & Business": "fa-chart-line" };

                aiNewsArray.forEach(item => {
                    const icon = iconMap[item.category] || "fa-newspaper";
                    html += `
                        <div class="news-tile">
                            <h5><i class="fa-solid ${icon} me-2"></i>${item.category}</h5>
                            <a href="${item.url}" target="_blank" class="headline-link">${item.headline}</a>
                            <span class="reason-text">${item.reason}</span>
                        </div>`;
                });
                area.innerHTML = html + `</div>`;
            } catch (e) {
                area.innerHTML = `<p class="text-danger">Sync Failure. Repository offline.</p>`;
            }
        }

        function startSnakeGame(speed) {
            const canvas = document.getElementById("snakeCanvas");
            const ctx = canvas.getContext("2d");
            const box = 20;
            let snake = [{x: 8 * box, y: 8 * box}], d, food = {x: 40, y: 40};
            snakeScore = 0;

            const updateScore = () => document.getElementById('current-score').innerText = snakeScore;

            document.addEventListener("keydown", e => {
                if(e.keyCode==37 && d!="RIGHT") d="LEFT"; if(e.keyCode==38 && d!="DOWN") d="UP";
                if(e.keyCode==39 && d!="LEFT") d="RIGHT"; if(e.keyCode==40 && d!="UP") d="DOWN";
            });

            ['up','down','left','right'].forEach(id => {
                document.getElementById(id).addEventListener('click', () => {
                    const dir = id.toUpperCase();
                    if(dir=="UP" && d!="DOWN") d="UP"; if(dir=="DOWN" && d!="UP") d="DOWN";
                    if(dir=="LEFT" && d!="RIGHT") d="LEFT"; if(dir=="RIGHT" && d!="LEFT") d="RIGHT";
                });
            });

            gameInterval = setInterval(() => {
                ctx.fillStyle = "#111"; ctx.fillRect(0,0,300,300);
                for(let i=0; i<snake.length; i++){
                    ctx.fillStyle = i==0 ? "#1e3799" : "#4a69bd";
                    ctx.fillRect(snake[i].x, snake[i].y, box-2, box-2);
                }
                ctx.fillStyle = "#2ecc71"; ctx.fillRect(food.x, food.y, box-2, box-2);
                
                let headX = snake[0].x, headY = snake[0].y;
                if(d=="LEFT") headX-=box; if(d=="UP") headY-=box; if(d=="RIGHT") headX+=box; if(d=="DOWN") headY+=box;

                // Continuous Wall logic
                if (headX < 0) headX = 280; if (headX >= 300) headX = 0;
                if (headY < 0) headY = 280; if (headY >= 300) headY = 0;

                if(headX==food.x && headY==food.y) {
                    snakeScore += 10;
                    updateScore();
                    food = {x: Math.floor(Math.random()*14+1)*box, y: Math.floor(Math.random()*14+1)*box};
                } else if(d) {
                    snake.pop();
                }
                
                if(d) snake.unshift({x:headX, y:headY});
            }, speed);
        }
    </script>
</body>
</html>